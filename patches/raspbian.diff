Description: Modify arm "detection" for Raspbian.

Index: openmpi-2.1.1.try3/config/opal_config_asm.m4
===================================================================
--- openmpi-2.1.1.try3.orig/config/opal_config_asm.m4
+++ openmpi-2.1.1.try3/config/opal_config_asm.m4
@@ -1037,7 +1037,7 @@ AC_DEFUN([OPAL_CONFIG_ASM],[
             OPAL_GCC_INLINE_ASSIGN='"mov %0, #0" : "=&r"(ret)'
             ;;
 
-        armv7*|arm-*-linux-gnueabihf)
+        armv7*)
             opal_cv_asm_arch="ARM"
             OPAL_ASM_SUPPORT_64BIT=1
             OPAL_ASM_ARM_VERSION=7
@@ -1046,11 +1046,10 @@ AC_DEFUN([OPAL_CONFIG_ASM],[
             OPAL_GCC_INLINE_ASSIGN='"mov %0, #0" : "=&r"(ret)'
             ;;
 
-        armv6*)
+        armv6*|arm-*-linux-gnueabihf)
             opal_cv_asm_arch="ARM"
             OPAL_ASM_SUPPORT_64BIT=0
             OPAL_ASM_ARM_VERSION=6
-            CCASFLAGS="$CCASFLAGS -march=armv7-a"
             AC_DEFINE_UNQUOTED([OPAL_ASM_ARM_VERSION], [$OPAL_ASM_ARM_VERSION],
                                [What ARM assembly version to use])
             OPAL_GCC_INLINE_ASSIGN='"mov %0, #0" : "=&r"(ret)'
Index: openmpi-2.1.1.try3/opal/asm/base/ARM.asm
===================================================================
--- openmpi-2.1.1.try3.orig/opal/asm/base/ARM.asm
+++ openmpi-2.1.1.try3/opal/asm/base/ARM.asm
@@ -3,19 +3,19 @@ START_FILE
 
        ALIGN(4)
 START_FUNC(opal_atomic_mb)
-       dmb
+       MCR p15, 0, r0, c7, c10, 5
        bx      lr
 END_FUNC(opal_atomic_mb)
 
 
 START_FUNC(opal_atomic_rmb)
-       dmb
+       MCR p15, 0, r0, c7, c10, 5
        bx      lr
 END_FUNC(opal_atomic_rmb)
 
 
 START_FUNC(opal_atomic_wmb)
-       dmb
+       MCR p15, 0, r0, c7, c10, 5
        bx      lr
 END_FUNC(opal_atomic_wmb)
 
@@ -43,7 +43,7 @@ START_FUNC(opal_atomic_cmpset_acq_32)
        strex   r12, r2, [r0]
        cmp     r12, #0
        bne     REFLSYM(3)
-       dmb
+       MCR p15, 0, r0, c7, c10, 5
        mov     r0, #1
        LSYM(4)
        movne   r0, #0
@@ -56,7 +56,7 @@ START_FUNC(opal_atomic_cmpset_rel_32)
        ldrex   r3, [r0]
        cmp     r1, r3
        bne     REFLSYM(6)
-       dmb
+       MCR p15, 0, r0, c7, c10, 5
        strex   r12, r2, [r0]
        cmp     r12, #0
        bne     REFLSYM(4)
@@ -98,7 +98,7 @@ START_FUNC(opal_atomic_cmpset_acq_64)
        strexd  r1, r6, r7, [r0]
        cmp     r1, #0
        bne     REFLSYM(9)
-       dmb
+       MCR p15, 0, r0, c7, c10, 5
        mov     r0, #1
        LSYM(10)
        movne   r0, #0
@@ -116,7 +116,7 @@ START_FUNC(opal_atomic_cmpset_rel_64)
        it      eq
        cmpeq   r5, r3
        bne     REFLSYM(12)
-       dmb
+       MCR p15, 0, r0, c7, c10, 5
        strexd  r1, r6, r7, [r0]
        cmp     r1, #0
        bne     REFLSYM(11)
